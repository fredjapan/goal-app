<%= render partial: "shared/goalheader", locals: {horizon: @horizon} %>

<div class="tabs is-medium is-boxed">
  <ul>
    <li class="<% if params[:term] == "term_previous" %>is-active<% end %>">
      <a href="/goals?horizon=<%= @horizon %>&term=term_previous">Previous <%= @horizon.capitalize.+"s" %></a>
    </li>
    <li class="<% if params[:term] == "term_this" %>is-active<% end %>">
      <a href="/goals?horizon=<%= @horizon %>&term=term_this">This <%= @horizon.capitalize %></a>
    </li>
    <li class="<% if params[:term] == "term_next" %>is-active<% end %>">
      <a href="/goals?horizon=<%= @horizon %>&term=term_next">Next <%= @horizon.capitalize %></a>
    </li>
  </ul>
</div>

<% @goals.group_by{ |goal| goal.date.send("beginning_of_#{@horizon}")}.sort.reverse.each do |term_start, goals|%>
  <div id="term-group" class="container">
    <%= form_with model: @goal, url: edit_multiple_goals_path, local: true, method: :get do %>
      <div class="<%= term_start %>">
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <%= @horizon.capitalize%> until ~
              <%= term_start.send("end_of_#{@horizon}") %>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <%= submit_tag "Update goals", class: "button is-small is-outlined is-primary level-item" %>
            </div>
          </div>
        </div>
        <table class="table is-fullwidth">
          <tr>
            <th>
            </th>
            <th>
              <p>Title</p>
            </th>
            <th>
              <p>Description</p>
            </th>
            <th>
              <p>Realted to</p>
            </th>
            <th>
              <p>Achievment</p>
            </th>
            <th class="is-hidden">
              <p>Date</p>
            </th>
            <th class="is-hidden"></th>
          </tr>
          <% @i = 1%>
          <% goals.each do |goal|%>
            <tr>
              <td>
                #<%= @i %>
                <%= hidden_field_tag "goal_ids[]", goal.id %>
                <%= hidden_field_tag "horizon", @horizon %>
              </td>
              <td>
                <%= link_to goal.title, goal_path(goal, horizon: @horizon) %>
              </td>
              <td>
                <%= goal.description %>
              </td>
              <td>
                <% if goal.related_goal_id.present? == true %>
                  <%= link_to @allgoals.find(goal.related_goal_id).title, goal_path(id: goal.related_goal_id,horizon: @horizon) %>
                <% end %>
              </td>
              <td>
                <% if goal.achievement == "achieved" %>
                  <span class="tag is-success is-light"><%= goal.achievement.capitalize %></span>
                <% elsif goal.achievement == "partially achieved" %>
                  <span class="tag is-warning is-light"><%= goal.achievement.capitalize %></span>
                <% elsif goal.achievement == "failed" %>
                  <span class="tag is-danger is-light"><%= goal.achievement.capitalize %></span>
                <% else %>
                <% end %>
              </td>
              <td class="is-hidden">
                <%= goal.date %>
              </td>
              <td class="is-hidden">
                <%= link_to  "Edit", edit_goal_path(goal), class: "button is-link" %>
              </td>
            </tr>
            <% @i += 1 %>
          <%end%>
        </table>
        <hr/>
        <br/>
      </div>
    <% end %>
  </div>
<% end %>

<script>
  $(function() {
   $("li").click(function() {
      $("li").removeClass("is-active");
      $("term is-active").addClass("is-hidden");
      $("term is-hidden").removeClass("is-hidden");
      $(this).addClass("is-active");
   });
  });
</script>