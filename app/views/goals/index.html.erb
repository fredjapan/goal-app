<%= render partial: "shared/goalheader", locals: {horizon: @horizon} %>

<% @goals.group_by{ |u| u.date.beginning_of_week}.sort.reverse.each do |week_start, goals|%>
  <div id="week" class="container">
    <%= form_with model: @goal, url: edit_multiple_goals_path, local: true, method: :get do %>
    <hr/>
    <div class="level">
      <div class="level-left">
        <h2 class="subtitle level-item">
          <% if DateTime.current.to_date.beginning_of_week == week_start %>
            This week
          <% elsif DateTime.current.to_date.beginning_of_week + 1.week == week_start %>
            Next week
          <% else %>
            Previous week ~ <%= week_start.end_of_week %>
          <% end %>
        </h2>
      </div>
      <div class="level-right">
        <%= submit_tag "Update goals", class: "button is-small is-outlined is-primary level-item" %>
      </div>
    </div>
      <table class="table is-fullwidth">
        <tr>
          <th>
            <p>#</p>
          </th>
          <th>
            <p>Title</p>
          </th>
          <th>
            <p>Description</p>
          </th>
          <th>
            <p>Realted to</p>
          </th>
          <th>
            <p>Achievment</p>
          </th>
          <th class="is-hidden">
            <p>Date</p>
          </th>
          <th class="is-hidden"></th>
        </tr>
        <% @i = 1%>
        <% goals.each do |goal|%>
          <tr>
            <td>
              Goal #<%= @i %>
              <%= hidden_field_tag "goal_ids[]", goal.id %>
              <%= hidden_field_tag "horizon", @horizon %>
            </td>
            <td>
              <%= link_to goal.title, goal_path(goal, horizon: @horizon) %>
            </td>
            <td>
              <%= goal.description %>
            </td>
            <td>
              <%= goal.related_goal_id %>
            </td>
            <td>
              <% if goal.achievement == "Achieved" %>
                <span class="tag is-success is-light"><%= goal.achievement %></span>
              <% elsif goal.achievement == "Partially achieved" %>
                <span class="tag is-warning is-light"><%= goal.achievement %></span>
              <% elsif goal.achievement == "Failed" %>
                <span class="tag is-danger is-light"><%= goal.achievement %></span>
              <% else %>
              <% end %>
            </td>
            <td class="is-hidden">
              <%= goal.date %>
            </td>
            <td class="is-hidden">
              <%= link_to  "Edit", edit_goal_path(goal), class: "button is-link" %>
            </td>
          </tr>
          <% @i += 1 %>
        <%end%>
      </table>
      <br/>
    <% end %>
  </div>
<% end %>
